﻿<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on http://github.com/jonrohan -->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <link rel="stylesheet" href="stylesheets/stylesheet.css" media="screen">
  <link rel="stylesheet" href="stylesheets/pygment_trac.css">
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/script.js"></script>

  <title>马文斌@博客</title>
  <meta name="description" content="">

  <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">马文斌@博客</h1>
    </header>
    <div id="container">
      <p class="tagline"></p>
        <article class="markdown-body">
<!-- Blog Post -->
<!-- Title -->
<h2>
  单例模式
  <div class="post-date"><a href="https://github.com/panxw/panxw.github.com/edit/master/_posts/2014-12-04-Design-Mode.md" target="_blank">纠错</a>&nbsp;&nbsp;
	<span class="glyphicon glyphicon-time"></span>
	04 Dec 2014
  </div>
</h2>
<!-- Author -->
<hr>
<h2>Properties存在的问题</h2>

<pre><code>1.简化包名为 .prop
2.根据不同操作系统加载不同的 properties 文件指示文件
3.使用双重检查锁
4.修改文件加载方式使相对路径不使用路径分隔符
5.使用 RuntimeException 封装 checked Exception
6.修改单元测试以断言异常
</code></pre>

<h2>单例模式</h2>

<pre><code>/**
 * 懒汉式单例模式将PropertiesParser类设置为单例
 */
public class SimpleProperties {

    private static volatile byte[] locker = new byte[0];
    private static PropertiesParser propertiesParser = null;

    private SimpleProperties() {
    }

    /**
     * 得到PropertiesParser对象
     * 
     * @Title: getInstance
     * @return PropertiesParser
     */
    public static PropertiesParser getInstance() {

        if (propertiesParser != null) {
            return propertiesParser;
        }

        String appPropName = "app.properties";

        switch (Environment.getOS()) {
        case Unix:
        case Mac:
            appPropName = "app_unix.properties";
            break;
        case Windows:
            appPropName = "app_win.properties";
            break;
        }

        synchronized (locker) {
            if (propertiesParser != null) {
                return propertiesParser;
            }

            Properties appProp = new PropertiesParser(appPropName)
                    .getProperties();
            String realPropName = appProp.getProperty("path");
            propertiesParser = new PropertiesParser(realPropName);
            return propertiesParser;
        }
    }

}
</code></pre>

<h2>异常测试</h2>

<pre><code>@Test
public void test文件名应当合法() {
    try {
        new PropertiesParser("");
        Assert.fail("Should throw IllegalArgumentException");
    } catch (IllegalArgumentException ex) {

    }
}   

@Test
public void test文件必须存在() {
    try {
        new PropertiesParser("notexist.properties");
        Assert.fail("Should throw RuntimeException");
    } catch (Exception ex) {
        Assert.assertTrue(ex.getCause() instanceof FileNotFoundException);
    }
}
</code></pre>

<h2>运行环境判断</h2>

<pre><code>public class Environment {

    public static OS getOS() {
        String os = System.getProperty("os.name").toLowerCase();
        if (OS.isUnix(os)) {
            return OS.Unix;
        }
        if (OS.isWindows(os)) {
            return OS.Windows;
        }
        if (OS.isMac(os)) {
            return OS.Mac;
        }

        throw new UnsupportedOperationException("Unsupported OS name: " + os);
    }

    public enum OS {
        Windows, Unix, Mac;

        static boolean isWindows(String os) {
            return (os.indexOf("win") &gt;= 0);
        }

        static boolean isMac(String os) {
            return (os.indexOf("mac") &gt;= 0);
        }

        static boolean isUnix(String os) {
            return (os.indexOf("nix") &gt;= 0 || os.indexOf("nux") &gt;= 0 || os
                    .indexOf("aix") &gt; 0);
        }

        static boolean isSolaris(String os) {
            return (os.indexOf("sunos") &gt;= 0);
        }
    }
}
</code></pre>

<br/>
<div style="margin-top:10px;margin-bottom:10px">
  
  <span class="next">
    上篇：
    <a href="/2014/12/Http-Client.html">
      HttpClient及有关jar包详解
    </a>
  </span>
   
  
  <span class="prev">
    下篇：
    <a href="/2014/12/Linux-Order.html">
      Linux常用指令
    </a>
  </span>
  
</div>
<hr>
<!-- Blog Comments -->
<div class="media">
    <!-- UY BEGIN -->
  <div id="uyan_frame">
  </div>
  <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1511840">
  </script>
  <!-- UY END --> 
</div>

        </article>
      
    </div>
    <footer>
      <div class="owner">

      <p><a href="https://github.com/mwb1219" class="avatar"><img src="https://avatars1.githubusercontent.com/u/9292203?v=3&amp;s=60" width="48" height="48"></a>View <a href="https://github.com/mwb1219">mwb1219</a> on <a href="https://www.github.com">GitHub</a></p>

      </div>
      <div class="creThis page generated using <a href="http://pages.github.com/">GitHub Pages</a><br>theme by <a href="https://twitter.com/jonrohan/">Jon Rohan</a>i>

</ul></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/mwb1219/mwb1219.github.io/tarball/master" class="tar">tar</a><a href="https://github.com/mwb1219/mwb1219.github.io/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>
  
</body>
</html>